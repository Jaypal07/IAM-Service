server:
  port: ${SERVER_PORT:8081}
  forward-headers-strategy: framework
  ssl:
    enabled: false
  shutdown: graceful
  error:
    include-message: never
    include-binding-errors: never
    include-stacktrace: never
    include-exception: false

spring:
  application:
    name: Auth-App-Backend

  datasource:
    url: jdbc:postgresql://localhost:5432/Auth-App
    username: postgres
    password: 1234
    driver-class-name: org.postgresql.Driver
    hikari:
      pool-name: ${DB_POOL_NAME:HikariCP}
      maximum-pool-size: ${DB_MAX_POOL_SIZE:20}
      minimum-idle: ${DB_MIN_IDLE:5}
      connection-timeout: ${DB_CONNECTION_TIMEOUT:10000}
      idle-timeout: ${DB_IDLE_TIMEOUT:600000}
      max-lifetime: ${DB_MAX_LIFETIME:1800000}
      validation-timeout: ${DB_VALIDATION_TIMEOUT:5000}
      leak-detection-threshold: ${DB_LEAK_DETECTION_THRESHOLD:60000}
      initialization-fail-timeout: -1
      auto-commit: true
      connection-test-query: SELECT 1

  jpa:
    hibernate:
      ddl-auto: update
    open-in-view: false
    show-sql: false
    properties:
      hibernate:
        default_schema: public
        format_sql: false
        jdbc:
          batch_size: 20
          fetch_size: 50
        order_inserts: true
        order_updates: true
        query:
          in_clause_parameter_padding: true
        connection:
          provider_disables_autocommit: false

  security:
    oauth2:
      client:
        registration:
          google:
            client-id: ${GOOGLE_CLIENT_ID:}
            client-secret: ${GOOGLE_CLIENT_SECRET:}
            scope:
              - openid
              - profile
              - email

          github:
            client-id: ${GITHUB_CLIENT_ID:}
            client-secret: ${GITHUB_CLIENT_SECRET:}
            scope:
              - user:email
              - read:user

        provider:
          google:
            authorization-uri: https://accounts.google.com/o/oauth2/v2/auth
            token-uri: https://oauth2.googleapis.com/token
            user-info-uri: https://www.googleapis.com/oauth2/v3/userinfo
            user-name-attribute: sub

          github:
            authorization-uri: https://github.com/login/oauth/authorize
            token-uri: https://github.com/login/oauth/access_token
            user-info-uri: https://api.github.com/user
            user-name-attribute: id

  mail:
    host: ${MAIL_HOST}
    port: ${MAIL_PORT}
    username: ${MAIL_USERNAME}
    password: ${MAIL_PASSWORD}
    properties:
      mail.smtp.auth: ${MAIL_SMTP_AUTH:true}
      mail.smtp.starttls.enable: ${MAIL_SMTP_STARTTLS_ENABLE:true}
      mail.smtp.timeout: 5000
      mail.smtp.connectiontimeout: 5000

  cache:
    type: caffeine
    caffeine:
      spec: maximumSize=10000,expireAfterWrite=900s

  task:
    scheduling:
      pool:
        size: 2

app:
  frontend:
    base-url: ${FRONTEND_BASE_URL}
    success-redirect: ${FRONTEND_SUCCESS_REDIRECT:}
    failure-redirect: ${FRONTEND_FAILURE_REDIRECT:}

security:
  jwt:
    secret: ${JWT_SECRET}
    issuer: ${JWT_ISSUER}
    access-ttl-seconds: ${JWT_ACCESS_TTL_SECONDS:900}
    refresh-ttl-seconds: ${JWT_REFRESH_TTL_SECONDS:86400}
    refresh-token-cookie-name: ${JWT_REFRESH_COOKIE_NAME:refreshToken}
    cookie-secure: ${JWT_COOKIE_SECURE:true}
    cookie-http-only: ${JWT_COOKIE_HTTP_ONLY:true}
    cookie-same-site: ${JWT_COOKIE_SAME_SITE:Strict}
    cookie-domain: ${JWT_COOKIE_DOMAIN:}

logging:
  level:
    root: INFO
    org.springframework.security: WARN
    org.hibernate.SQL: WARN
    org.hibernate.type.descriptor.sql.BasicBinder: WARN
    com.jaypal.authapp: DEBUG
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} - %msg%n"
    file: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"

management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics
      base-path: /actuator
  endpoint:
    health:
      show-details: when-authorized
  metrics:
    export:
      simple:
        enabled: true

#  /*
#PRODUCTION IMPROVEMENTS:
#  1. Increased HikariCP pool size (5 → 20) for production load
#  2. Increased minimum idle (2 → 5) for better connection availability
#  3. Enabled leak detection (60 seconds threshold)
#  4. Added connection test query for health checks
#  5. Changed ddl-auto from update to validate (safer for production)
#  6. Disabled show-sql (performance + security)
#7. Enabled Hibernate batch operations (batch_size: 20)
#8. Added JDBC fetch size optimization (fetch_size: 50)
#  9. Enabled order_inserts and order_updates for batching
#  10. Added mail timeouts to prevent hanging
#  11. Configured Caffeine cache properly
#  12. Added scheduling pool for cleanup jobs
#  13. Changed SameSite from Lax to Strict for production security
#  14. Disabled error stack traces in responses (security)
#  15. Added graceful shutdown
#  16. Configured actuator endpoints for monitoring
#  17. Added proper logging patterns
#  */